{"version":3,"file":"KubernetesContent.esm.js","sources":["../src/KubernetesContent.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport { Entity } from '@backstage/catalog-model';\nimport {\n  ErrorPanel,\n  ErrorReporting,\n  Cluster,\n  useKubernetesObjects,\n  DetectedErrorsContext,\n} from '@backstage/plugin-kubernetes-react';\nimport {\n  DetectedError,\n  detectErrors,\n} from '@backstage/plugin-kubernetes-common';\nimport {\n  Content,\n  EmptyState,\n  Page,\n  Progress,\n} from '@backstage/core-components';\nimport { RequireKubernetesPermissions } from './RequireKubernetesPermissions';\n\ntype KubernetesContentProps = {\n  entity: Entity;\n  refreshIntervalMs?: number;\n  children?: React.ReactNode;\n};\n\nexport const KubernetesContent = ({\n  entity,\n  refreshIntervalMs,\n}: KubernetesContentProps) => {\n  const { kubernetesObjects, error } = useKubernetesObjects(\n    entity,\n    refreshIntervalMs,\n  );\n\n  const clusters = kubernetesObjects?.items.map(item => item.cluster) ?? [];\n\n  const clustersWithErrors =\n    kubernetesObjects?.items.filter(r => r.errors.length > 0) ?? [];\n\n  const detectedErrors =\n    kubernetesObjects !== undefined\n      ? detectErrors(kubernetesObjects)\n      : new Map<string, DetectedError[]>();\n\n  return (\n    <Page themeId=\"tool\">\n      <Content>\n        <RequireKubernetesPermissions>\n          <DetectedErrorsContext.Provider\n            value={[...detectedErrors.values()].flat()}\n          >\n            {kubernetesObjects === undefined && error === undefined && (\n              <Progress />\n            )}\n\n            {/* errors retrieved from the kubernetes clusters */}\n            {clustersWithErrors.length > 0 && (\n              <Grid container spacing={3} direction=\"column\">\n                <Grid item>\n                  <ErrorPanel\n                    entityName={entity.metadata.name}\n                    clustersWithErrors={clustersWithErrors}\n                  />\n                </Grid>\n              </Grid>\n            )}\n\n            {/* other errors */}\n            {error !== undefined && (\n              <Grid container spacing={3} direction=\"column\">\n                <Grid item>\n                  <ErrorPanel\n                    entityName={entity.metadata.name}\n                    errorMessage={error}\n                  />\n                </Grid>\n              </Grid>\n            )}\n\n            {kubernetesObjects && (\n              <Grid container spacing={3} direction=\"column\">\n                <Grid item>\n                  <ErrorReporting\n                    detectedErrors={detectedErrors}\n                    clusters={clusters}\n                  />\n                </Grid>\n                <Grid item>\n                  <Typography variant=\"h3\">Your Clusters</Typography>\n                </Grid>\n                <Grid item container>\n                  {kubernetesObjects?.items.length <= 0 && (\n                    <Grid\n                      container\n                      justifyContent=\"space-around\"\n                      direction=\"row\"\n                      alignItems=\"center\"\n                      spacing={2}\n                    >\n                      <Grid item xs={8}>\n                        <EmptyState\n                          missing=\"data\"\n                          title=\"No Kubernetes resources\"\n                          description={`No resources on any known clusters for ${entity.metadata.name}`}\n                        />\n                      </Grid>\n                    </Grid>\n                  )}\n                  {kubernetesObjects?.items.length > 0 &&\n                    kubernetesObjects?.items.map((item, i) => {\n                      const podsWithErrors = new Set<string>(\n                        detectedErrors\n                          .get(item.cluster.name)\n                          ?.filter(de => de.sourceRef.kind === 'Pod')\n                          .map(de => de.sourceRef.name),\n                      );\n\n                      return (\n                        <Grid item key={i} xs={12}>\n                          <Cluster\n                            clusterObjects={item}\n                            podsWithErrors={podsWithErrors}\n                          />\n                        </Grid>\n                      );\n                    })}\n                </Grid>\n              </Grid>\n            )}\n          </DetectedErrorsContext.Provider>\n        </RequireKubernetesPermissions>\n      </Content>\n    </Page>\n  );\n};\n"],"names":[],"mappings":"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"}