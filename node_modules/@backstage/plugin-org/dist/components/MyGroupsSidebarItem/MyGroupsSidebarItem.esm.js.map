{"version":3,"file":"MyGroupsSidebarItem.esm.js","sources":["../../../src/components/MyGroupsSidebarItem/MyGroupsSidebarItem.tsx"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport {\n  DEFAULT_NAMESPACE,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport {\n  SidebarItem,\n  SidebarSubmenu,\n  SidebarSubmenuItem,\n} from '@backstage/core-components';\nimport {\n  IconComponent,\n  identityApiRef,\n  useApi,\n  useRouteRef,\n} from '@backstage/core-plugin-api';\nimport useAsync from 'react-use/esm/useAsync';\nimport {\n  catalogApiRef,\n  CatalogApi,\n  entityRouteRef,\n} from '@backstage/plugin-catalog-react';\nimport { getCompoundEntityRef } from '@backstage/catalog-model';\n\nimport { entityPresentationApiRef } from '@backstage/plugin-catalog-react';\n\n/**\n * MyGroupsSidebarItem can be added to your sidebar providing quick access to groups the logged in user is a member of\n *\n * @public\n */\nexport const MyGroupsSidebarItem = (props: {\n  singularTitle: string;\n  pluralTitle: string;\n  icon: IconComponent;\n  filter?: Record<string, string | symbol | (string | symbol)[]>;\n}) => {\n  const { singularTitle, pluralTitle, icon, filter } = props;\n\n  const identityApi = useApi(identityApiRef);\n  const catalogApi: CatalogApi = useApi(catalogApiRef);\n  const catalogEntityRoute = useRouteRef(entityRouteRef);\n  const entityPresentationApi = useApi(entityPresentationApiRef);\n\n  const { value: groups } = useAsync(async () => {\n    const profile = await identityApi.getBackstageIdentity();\n\n    const response = await catalogApi.getEntities({\n      filter: [\n        {\n          kind: 'group',\n          'relations.hasMember': profile.userEntityRef,\n          ...(filter ?? {}),\n        },\n      ],\n      fields: ['metadata', 'kind'],\n    });\n    return response.items;\n  }, []);\n\n  if (!groups?.length) {\n    return null;\n  }\n\n  // Only member of one group\n  if (groups.length === 1) {\n    const group = groups[0];\n    return (\n      <SidebarItem\n        text={singularTitle}\n        to={catalogEntityRoute(getCompoundEntityRef(group))}\n        icon={icon}\n      />\n    );\n  }\n\n  // Member of more than one group\n  return (\n    <SidebarItem icon={icon} text={pluralTitle}>\n      <SidebarSubmenu title={pluralTitle}>\n        {groups?.map(group => {\n          const entityDisplayName = entityPresentationApi.forEntity(group);\n          return (\n            <SidebarSubmenuItem\n              title={entityDisplayName.snapshot.primaryTitle}\n              subtitle={\n                group.metadata.namespace !== DEFAULT_NAMESPACE\n                  ? group.metadata.namespace\n                  : undefined\n              }\n              to={catalogEntityRoute(getCompoundEntityRef(group))}\n              icon={icon}\n              key={stringifyEntityRef(group)}\n            />\n          );\n        })}\n      </SidebarSubmenu>\n    </SidebarItem>\n  );\n};\n"],"names":[],"mappings":";;;;;;;AA+Ca,MAAA,mBAAA,GAAsB,CAAC,KAK9B,KAAA;AACJ,EAAA,MAAM,EAAE,aAAA,EAAe,WAAa,EAAA,IAAA,EAAM,QAAW,GAAA,KAAA;AAErD,EAAM,MAAA,WAAA,GAAc,OAAO,cAAc,CAAA;AACzC,EAAM,MAAA,UAAA,GAAyB,OAAO,aAAa,CAAA;AACnD,EAAM,MAAA,kBAAA,GAAqB,YAAY,cAAc,CAAA;AACrD,EAAM,MAAA,qBAAA,GAAwB,OAAO,wBAAwB,CAAA;AAE7D,EAAA,MAAM,EAAE,KAAA,EAAO,MAAO,EAAA,GAAI,SAAS,YAAY;AAC7C,IAAM,MAAA,OAAA,GAAU,MAAM,WAAA,CAAY,oBAAqB,EAAA;AAEvD,IAAM,MAAA,QAAA,GAAW,MAAM,UAAA,CAAW,WAAY,CAAA;AAAA,MAC5C,MAAQ,EAAA;AAAA,QACN;AAAA,UACE,IAAM,EAAA,OAAA;AAAA,UACN,uBAAuB,OAAQ,CAAA,aAAA;AAAA,UAC/B,GAAI,UAAU;AAAC;AACjB,OACF;AAAA,MACA,MAAA,EAAQ,CAAC,UAAA,EAAY,MAAM;AAAA,KAC5B,CAAA;AACD,IAAA,OAAO,QAAS,CAAA,KAAA;AAAA,GAClB,EAAG,EAAE,CAAA;AAEL,EAAI,IAAA,CAAC,QAAQ,MAAQ,EAAA;AACnB,IAAO,OAAA,IAAA;AAAA;AAIT,EAAI,IAAA,MAAA,CAAO,WAAW,CAAG,EAAA;AACvB,IAAM,MAAA,KAAA,GAAQ,OAAO,CAAC,CAAA;AACtB,IACE,uBAAA,KAAA,CAAA,aAAA;AAAA,MAAC,WAAA;AAAA,MAAA;AAAA,QACC,IAAM,EAAA,aAAA;AAAA,QACN,EAAI,EAAA,kBAAA,CAAmB,oBAAqB,CAAA,KAAK,CAAC,CAAA;AAAA,QAClD;AAAA;AAAA,KACF;AAAA;AAKJ,EACE,uBAAA,KAAA,CAAA,aAAA,CAAC,WAAY,EAAA,EAAA,IAAA,EAAY,IAAM,EAAA,WAAA,EAAA,kBAC5B,KAAA,CAAA,aAAA,CAAA,cAAA,EAAA,EAAe,KAAO,EAAA,WAAA,EAAA,EACpB,MAAQ,EAAA,GAAA,CAAI,CAAS,KAAA,KAAA;AACpB,IAAM,MAAA,iBAAA,GAAoB,qBAAsB,CAAA,SAAA,CAAU,KAAK,CAAA;AAC/D,IACE,uBAAA,KAAA,CAAA,aAAA;AAAA,MAAC,kBAAA;AAAA,MAAA;AAAA,QACC,KAAA,EAAO,kBAAkB,QAAS,CAAA,YAAA;AAAA,QAClC,UACE,KAAM,CAAA,QAAA,CAAS,cAAc,iBACzB,GAAA,KAAA,CAAM,SAAS,SACf,GAAA,KAAA,CAAA;AAAA,QAEN,EAAI,EAAA,kBAAA,CAAmB,oBAAqB,CAAA,KAAK,CAAC,CAAA;AAAA,QAClD,IAAA;AAAA,QACA,GAAA,EAAK,mBAAmB,KAAK;AAAA;AAAA,KAC/B;AAAA,GAEH,CACH,CACF,CAAA;AAEJ;;;;"}